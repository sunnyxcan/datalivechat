{# detail_livechat.html - Tidak perlu extends base.html, akan di-include #}

<div class="flex flex-wrap gap-5 mb-10 items-start">
    
    {%- if kesalahan_headers and kesalahan_data -%}
    <div class="table-kesalahan w-full lg:flex-1 lg:max-w-[40%] bg-white shadow-xl rounded-lg overflow-hidden border border-gray-100 p-4">
        <div class="flex justify-between items-center mb-4 px-2 pt-2">
            <h2 class="text-2xl font-semibold text-gray-800">Detail Kesalahan</h2>
            
            {%- if available_months -%}
            <div class="flex items-center space-x-2">
                <label for="month-filter" class="text-sm font-medium text-gray-700">Filter Bulan:</label>
                <select id="month-filter" 
                        onchange="window.location.href = this.value" 
                        class="block w-full py-1.5 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    
                    {%- for month in available_months -%}
                    <option value="{{ url_for('show_data', sheet_name=current_sheet, month_filter=month) }}"
                            {%- if current_month_filter == month -%}selected{%- endif -%}>
                            {%- if month == 'all' -%}
                                Semua Bulan
                            {%- else -%}
                                {{- month -}}
                            {%- endif -%}
                    </option>
                    {%- endfor -%}
                </select>
            </div>
            {%- endif -%}
        </div>
        
        <div class="overflow-x-auto max-h-[calc(100vh-120px)]">
            <table class="data-table w-full text-sm text-left border-collapse">
                <thead class="text-xs text-white uppercase bg-gray-900 sticky top-0 z-10">
                    <tr>
                        {%- for header in kesalahan_headers -%}
                        <th scope="col" class="px-6 py-3 {%- if loop.index == 2 -%}min-w-[150px]{%- endif -%}">{{- header -}}</th>
                        {%- endfor -%}
                    </tr>
                </thead>
                <tbody>
                    {%- for row in kesalahan_data -%}
                    <tr class="bg-white border-b hover:bg-indigo-200 transition duration-150">
                        {%- for cell in row -%}
                        <td class="px-6 py-3 align-top link-cell">
                            <div class="cell-content max-w-[250px] break-words">
                                {{- cell | render_cell | safe -}}
                            </div>
                        </td>
                        {%- endfor -%}
                    </tr>
                    {%- endfor -%}
                    {%- if current_sheet in SHEET_KHUSUS -%}
                    <tr class="summary-total bg-emerald-600 text-white font-bold hover:bg-emerald-700 transition duration-150">
                        <td colspan="{{- kesalahan_headers|length -}}" class="px-6 py-3 text-base">Total: {{- kesalahan_data|length -}} baris</td>
                    </tr>
                    {%- endif -%}
                </tbody>
            </table>
        </div>
    </div>
    {%- else -%}
    <p class="text-gray-500 italic flex-1 w-full lg:max-w-[40%] bg-white shadow-xl rounded-lg p-6">Tidak ada data kesalahan untuk sheet ini.</p>
    {%- endif -%}

    {%- if staff_headers and staff_rows -%}
    <div class="table-staff w-full lg:flex-1 lg:max-w-[58%] bg-white shadow-xl rounded-lg overflow-hidden border border-gray-100">

        <div class="flex justify-between items-center px-6 pt-4 mb-4">
            <h2 class="text-2xl font-semibold text-gray-800">Data Staff</h2>
            {%- if total_kesalahan_staff is not none -%}
            <div class="text-lg font-bold text-red-600 bg-red-100 px-3 py-1 rounded-full shadow-md">
                TOTAL KESALAHAN: {{- total_kesalahan_staff | format_number -}}
            </div>
            {%- endif -%}
        </div>

        <div class="overflow-x-auto max-h-[calc(100vh-120px)] main-content-custom">
            <table class="data-table w-full text-sm text-left border-collapse table-auto">
                <thead class="text-xs text-white uppercase bg-gray-900 sticky top-0 z-20">
                    <tr>
                        {%- for header in staff_headers -%}
                        <th scope="col" class="px-6 py-3 whitespace-nowrap
                            {%- if loop.index == 1 -%}
                                lg:sticky-col-header lg:z-30
                            {%- endif -%}
                            {%- if loop.index == 2 -%}text-right{%- endif -%}"> {{- header -}}
                        </th>
                        {%- endfor -%}
                    </tr>
                </thead>
                <tbody class="staff-table-body">
                    {%- for row in staff_rows -%}
                    <tr class="border-b hover:bg-indigo-200 transition duration-150">
                        {%- for cell in row -%}
                        <td class="px-6 py-3 whitespace-nowrap align-top
                            {%- if loop.index == 1 -%}
                                lg:lg-sticky-col-cell 
                                font-semibold text-gray-900
                                {%- if loop.cycle('odd', 'even') == 'odd' -%}lg:bg-white{%- else -%}lg:bg-gray-50{%- endif -%}
                            {%- endif -%}
                            {%- if loop.index == 2 -%}text-center font-bold text-red-600{%- endif -%}">
                            {{- cell -}}
                        </td>
                        {%- endfor -%}
                    </tr>
                    {%- endfor -%}
                </tbody>
            </table>
        </div>
    </div>
    {%- elif current_sheet not in SHEET_KHUSUS -%}
    <p class="text-gray-500 italic flex-1 w-full lg:max-w-[58%] bg-white shadow-xl rounded-lg p-6">Tidak ada data staff untuk sheet ini.</p>
    {%- endif -%}

</div>